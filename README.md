# S/Key demo

分为服务端和客户端，实现了普通用户和管理员的一些功能。普通用户的功能包括注册、登陆、重置密码、申请解冻和修改密码。管理员分为安全管理员和日志管理员，安全管理员可以审核普通用户的重置密码和解冻申请，日志管理员可以从服务器下载日志文件。

服务端可以通过修改配置文件`setting.ini`对部分设置进行修改，分为三个部分`database`、`server`、`function`。

```ini
[database]
db_user=root							#数据库用户名
db_password=root						#数据库密码
db_port=3306							#数据库开放的端口
db_database=S_KEY						#数据库名称
db_server=127.0.0.1						#数据库主机
[server]
s_port=10086							#服务端监听的端口
[function]
no_login_period=30						#账户多日不登录，进行冻结
password_change_period=15				#账户多日不修改密码，强制进行修改
```



## 信号量

服务器通过客户端发送的信号量来进行不同的操作，这些信号量定义在`OperationSignals.h`中，其中分为服务端和客户端发出的信号量。

### 客户端信号量

| 名称              | 值   | 含义                         |
| ----------------- | ---- | ---------------------------- |
| C_REGISTER        | 1001 | 客户端请求注册新账户         |
| C_LOGIN           | 1002 | 客户端请求登陆               |
| C_RESET_PASSWORD  | 1003 | 客户端请求重置密码           |
| C_LOGOUT          | 1004 | 客户端关闭                   |
| C_UNFREEZE        | 1005 | 客户端发起账户解冻申请       |
| C_ADMIN_LOGIN     | 1006 | 客户端使用管理员账户登陆     |
| C_UPDATE_PASSWORD | 1007 | 客户端请求修改密码           |
| C_GET_REQUEST     | 1008 | 安全管理员获取普通账户的请求 |
| C_GET_LOG         | 1009 | 日志管理员获取日志文件       |
| C_REQUEST_PASS    | 1010 | 安全管理员通过用户申请       |
| C_REQUEST_REJECT  | 1011 | 安全管理员驳回用户申请       |

### 服务器信号量

| 名称              | 值   | 含义                     |
| ----------------- | ---- | ------------------------ |
| S_ACCESS          | 2001 | 客户端操作成功           |
| S_FAILED          | 2002 | 客户端操作失败           |
| S_UPDATE_PASSWORD | 2003 | 强制账户修改密码         |
| S_FROZEN          | 2004 | 账户被冻结               |
| S_NEXTSTEP        | 2005 | 客户端需要进行下一步处理 |
| S_NEW_RANDOM      | 2006 | 账户需要变更新的随机数   |
| S_USER_EXIST      | 2007 | 注册的账户已存在         |
| S_BLOCK           | 2008 | 账户被锁定，稍后重试     |
| S_REPEAT          | 2009 | 该请求已经发出，等待处理 |



## 服务端

数据库采用的是Mysql，版本为5.7.26，数据库文件为`ISEM.sql`，运行时需要将`libmysql.dll`放在同一目录下。



## 客户端

基于MFC框架，需要先运行服务端程序，才可以正常使用。

同一账户长时间不登录会被冻结，长时间不修改密码会在登陆后强制修改密码；在注册和修改密码时，对密码的长度和复杂性有要求。



## 用到的库

boost 1.80.0

Win64 OpenSSL v1.1.1t
